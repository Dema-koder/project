{% extends 'core/base.html' %}

{% block title %}–ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è - –ü—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–µ –º–µ–Ω—é{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="mb-0">üìã –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è: {{ event.name }}</h3>
                        <p class="mb-0">{{ event.event_date }} ‚Ä¢ {{ event.number_of_guests }} –≥–æ—Å—Ç–µ–π</p>
                    </div>
                    <a href="/event/{{ event.id }}/menu/" class="btn btn-light">
                        üéØ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–µ–Ω—é
                    </a>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-8">
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">üë• –ì–æ—Å—Ç–∏ –∏ –∏—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</h5>
                        <span class="badge bg-primary">{{ guests.count }} –≥–æ—Å—Ç–µ–π</span>
                    </div>
                    <div class="card-body">
                        {% for guest in guests %}
                        <div class="card mb-3">
                            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">üë§ {{ guest.name }}</h6>
                                <div>
                                    <a href="/event/{{ event.id }}/guest/{{ guest.id }}/edit/"
                                       class="btn btn-sm btn-outline-warning">
                                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                    </a>
                                    <a href="/event/{{ event.id }}/guest/{{ guest.id }}/delete/"
                                       class="btn btn-sm btn-outline-danger ms-1"
                                       onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –≥–æ—Å—Ç—è {{ guest.name }}?')">
                                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                    </a>
                                </div>
                            </div>
                            <div class="card-body">
                                {% if guest.favorite_dishes.all %}
                                <div class="row">
                                    {% for dish in guest.favorite_dishes.all %}
                                    <div class="col-md-6 mb-2">
                                        <div class="border rounded p-2">
                                            <strong>{{ dish.name }}</strong>
                                            <br>
                                            <small class="text-muted">
                                                {{ dish.dish_type.name|default:"–†–∞–∑–Ω–æ–µ" }} ‚Ä¢
                                                {{ dish.cooking_time }} –º–∏–Ω ‚Ä¢
                                                <span class="badge bg-secondary">{{ dish.get_difficulty_display }}</span>
                                            </small>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% else %}
                                <div class="alert alert-warning py-2 mb-0">
                                    <small>–ì–æ—Å—Ç—å –Ω–µ –≤—ã–±—Ä–∞–ª –ª—é–±–∏–º—ã–µ –±–ª—é–¥–∞</small>
                                </div>
                                {% endif %}
                            </div>
                            <div class="card-footer bg-transparent py-2">
                                <small class="text-muted">
                                    –í—ã–±—Ä–∞–Ω–æ –±–ª—é–¥: {{ guest.favorite_dishes.count }}
                                </small>
                            </div>
                        </div>
                        {% empty %}
                        <div class="alert alert-warning text-center py-4">
                            <h5>üòî –ù–∞ —ç—Ç–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≥–æ—Å—Ç–∏</h5>
                            <p class="mb-0">
                                <a href="/event/{{ event.id }}/guests/" class="btn btn-primary mt-2">
                                    üë• –î–æ–±–∞–≤–∏—Ç—å –≥–æ—Å—Ç–µ–π
                                </a>
                            </p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>–í—Å–µ–≥–æ –≥–æ—Å—Ç–µ–π:</span>
                                <span class="badge bg-primary rounded-pill">{{ guests.count }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>–í—ã–±—Ä–∞–ª–∏ –±–ª—é–¥–∞:</span>
                                <span class="badge bg-success rounded-pill">
                                    {{ guests_with_dishes }}/{{ guests.count }}
                                </span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>–í—Å–µ–≥–æ –≤—ã–±—Ä–∞–Ω–æ –±–ª—é–¥:</span>
                                <span class="badge bg-info rounded-pill">{{ total_dishes }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>–°—Ä–µ–¥–Ω–µ–µ –Ω–∞ –≥–æ—Å—Ç—è:</span>
                                <span class="badge bg-warning text-dark rounded-pill">
                                    {% if guests.count > 0 %}
                                        {{ total_dishes|floatformat:1 }}
                                    {% else %}
                                        0
                                    {% endif %}
                                </span>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header">
                        <h5>üöÄ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h5>
                    </div>
                    <div class="card-body">
                        <a href="/event/{{ event.id }}/guests/" class="btn btn-primary w-100 mb-2">
                            üë• –î–æ–±–∞–≤–∏—Ç—å –≥–æ—Å—Ç–µ–π
                        </a>
                        <a href="/event/{{ event.id }}/menu/" class="btn btn-success w-100 mb-2">
                            üéØ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–µ–Ω—é
                        </a>
                        <a href="/create/" class="btn btn-outline-secondary w-100">
                            üéâ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ
                        </a>
                    </div>
                </div>

                <div class="alert alert-info">
                    <h6>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</h6>
                    <p class="mb-0 small">
                        –ù–∞–∂–º–∏—Ç–µ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" —Ä—è–¥–æ–º —Å –∏–º–µ–Ω–µ–º –≥–æ—Å—Ç—è, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –µ–≥–æ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}