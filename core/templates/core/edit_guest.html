{% extends 'core/base.html' %}

{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ—Å—Ç—è - –ü—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–µ –º–µ–Ω—é{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="mb-0">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ—Å—Ç—è</h3>
                        <p class="mb-0">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ: {{ event.name }}</p>
                    </div>
                    <a href="/event/{{ event.id }}/show/" class="btn btn-light btn-sm">
                        ‚Üê –ù–∞–∑–∞–¥
                    </a>
                </div>
            </div>

            <div class="card-body">
                <form method="post">
                    {% csrf_token %}

                    <!-- –ò–º—è –≥–æ—Å—Ç—è -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">–ò–º—è –≥–æ—Å—Ç—è:</label>
                        <input type="text"
                               name="guest_name"
                               class="form-control form-control-lg"
                               value="{{ guest.name }}"
                               required>
                        <div class="form-text">–ò–∑–º–µ–Ω–∏—Ç–µ –∏–º—è –≥–æ—Å—Ç—è, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ</div>
                    </div>

                    <!-- –í—ã–±–æ—Ä –ª—é–±–∏–º—ã—Ö –±–ª—é–¥ -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">–õ—é–±–∏–º—ã–µ –±–ª—é–¥–∞:</label>
                        <p class="text-muted">–í—ã–±–µ—Ä–∏—Ç–µ –±–ª—é–¥–∞, –∫–æ—Ç–æ—Ä—ã–µ –Ω—Ä–∞–≤—è—Ç—Å—è —ç—Ç–æ–º—É –≥–æ—Å—Ç—é</p>

                        <div class="row">
                            <!-- –§–∏–ª—å—Ç—Ä—ã –ø–æ —Ç–∏–ø–∞–º –±–ª—é–¥ -->
                            <div class="col-md-3 mb-3">
                                <div class="list-group">
                                    <button type="button" class="list-group-item list-group-item-action filter-btn active" data-filter="all">
                                        –í—Å–µ –±–ª—é–¥–∞
                                    </button>
                                    {% for dish_type in dish_types %}
                                    <button type="button" class="list-group-item list-group-item-action filter-btn" data-filter="type-{{ dish_type.id }}">
                                        {{ dish_type.name }}
                                    </button>
                                    {% endfor %}
                                </div>
                            </div>

                            <!-- –°–ø–∏—Å–æ–∫ –±–ª—é–¥ -->
                            <div class="col-md-9">
                                <div class="border rounded p-3" style="max-height: 400px; overflow-y: auto;">
                                    <div class="row" id="dishes-container">
                                        {% for dish in dishes %}
                                        <div class="col-md-6 mb-2 dish-item" data-types="type-{{ dish.dish_type.id|default:0 }}">
                                            <div class="form-check">
                                                <input class="form-check-input"
                                                       type="checkbox"
                                                       name="favorite_dishes"
                                                       value="{{ dish.id }}"
                                                       id="dish-{{ dish.id }}"
                                                       {% if dish.id in selected_dishes %}checked{% endif %}>
                                                <label class="form-check-label w-100" for="dish-{{ dish.id }}">
                                                    <div class="border rounded p-2 {% if dish.id in selected_dishes %}border-success bg-success-light{% endif %}">
                                                        <strong>{{ dish.name }}</strong>
                                                        <br>
                                                        <small class="text-muted">
                                                            {{ dish.dish_type.name|default:"–†–∞–∑–Ω–æ–µ" }} ‚Ä¢
                                                            {{ dish.cooking_time }} –º–∏–Ω
                                                        </small>
                                                    </div>
                                                </label>
                                            </div>
                                        </div>
                                        {% empty %}
                                        <div class="col-12 text-center py-3">
                                            <p class="text-muted">–ù–µ—Ç –±–ª—é–¥ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</p>
                                            <a href="/admin/core/dish/add/" class="btn btn-sm btn-outline-primary">
                                                ‚ûï –î–æ–±–∞–≤–∏—Ç—å –±–ª—é–¥–æ
                                            </a>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="/event/{{ event.id }}/show/" class="btn btn-secondary">
                            ‚Üê –û—Ç–º–µ–Ω–∞
                        </a>
                        <div>
                            <button type="submit" class="btn btn-success">
                                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                            </button>
                            <a href="/event/{{ event.id }}/guest/{{ guest.id }}/delete/"
                               class="btn btn-outline-danger ms-2"
                               onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –≥–æ—Å—Ç—è –∏–∑ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è?')">
                                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≥–æ—Å—Ç—è
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∞ -->
        <div class="alert alert-info mt-3">
            <h6>üí° –°–æ–≤–µ—Ç:</h6>
            <p class="mb-0">–í—ã–±–µ—Ä–∏—Ç–µ 3-5 –ª—é–±–∏–º—ã—Ö –±–ª—é–¥ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–æ—Å—Ç—è –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –ø–æ–¥–±–æ—Ä–∞ –º–µ–Ω—é</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±–ª—é–¥ –ø–æ —Ç–∏–ø–∞–º
        const filterButtons = document.querySelectorAll('.filter-btn');
        const dishItems = document.querySelectorAll('.dish-item');

        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
                filterButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');

                const filter = this.dataset.filter;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –±–ª—é–¥–∞
                dishItems.forEach(item => {
                    if (filter === 'all' || item.dataset.types.includes(filter)) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        });

        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –±–ª—é–¥
        const checkboxes = document.querySelectorAll('input[name="favorite_dishes"]');
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const labelDiv = this.closest('.form-check').querySelector('.border.rounded');
                if (this.checked) {
                    labelDiv.classList.add('border-success', 'bg-success-light');
                } else {
                    labelDiv.classList.remove('border-success', 'bg-success-light');
                }
            });
        });
    });
</script>
{% endblock %}

<style>
    .bg-success-light {
        background-color: rgba(25, 135, 84, 0.1) !important;
    }
</style>