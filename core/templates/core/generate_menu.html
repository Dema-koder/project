{% extends 'core/base.html' %}

{% block title %}–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–µ –º–µ–Ω—é - –ü—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–µ –º–µ–Ω—é{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <!-- –®–∞–ø–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è -->
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="mb-0">üéØ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–µ –º–µ–Ω—é</h3>
                        <p class="mb-0">{{ event.name }} ‚Ä¢ {{ event.event_date }} ‚Ä¢ {{ event.number_of_guests }} –≥–æ—Å—Ç–µ–π</p>
                    </div>
                    <a href="/event/{{ event.id }}/show/" class="btn btn-light btn-sm">
                        üë• –ü–æ–∫–∞–∑–∞—Ç—å –≥–æ—Å—Ç–µ–π
                    </a>
                </div>
            </div>
        </div>

        <!-- –¢–æ–ø –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –±–ª—é–¥ -->
        <div class="card mb-4">
            <div class="card-header">
                <h4>üèÜ –¢–æ–ø –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –±–ª—é–¥</h4>
                <p class="mb-0 text-muted">–ë–ª—é–¥–∞, –∫–æ—Ç–æ—Ä—ã–µ –Ω—Ä–∞–≤—è—Ç—Å—è –Ω–∞–∏–±–æ–ª—å—à–µ–º—É —á–∏—Å–ª—É –≥–æ—Å—Ç–µ–π</p>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for dish, count in popular_dishes %}
                    <div class="col-md-6 mb-3">
                        <div class="card h-100 border-success border-2">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h5 class="card-title">{{ dish.name }}</h5>
                                        <p class="card-text mb-1">
                                            <span class="badge bg-secondary">
                                                {{ dish.dish_type.name|default:"–†–∞–∑–Ω–æ–µ" }}
                                            </span>
                                            <span class="badge bg-warning text-dark ms-1">
                                                ‚è±Ô∏è {{ dish.cooking_time }} –º–∏–Ω
                                            </span>
                                        </p>
                                    </div>
                                    <div class="text-end">
                                        <span class="badge bg-success fs-6">
                                            {{ count }}/{{ event.number_of_guests }}
                                        </span>
                                        <div class="small text-muted mt-1">–≥o—Å—Ç–µ–π</div>
                                    </div>
                                </div>

                                <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ -->
                                <div class="mt-3">
                                    <div class="progress" style="height: 10px;">
                                        {% widthratio count event.number_of_guests 100 as popularity_percent %}
                                        <div class="progress-bar bg-success"
                                             role="progressbar"
                                             style="width: {{ popularity_percent }}%"
                                             aria-valuenow="{{ popularity_percent }}"
                                             aria-valuemin="0"
                                             aria-valuemax="100">
                                        </div>
                                    </div>
                                    <div class="small text-muted text-center mt-1">
                                        {{ popularity_percent }}% –≥–æ—Å—Ç–µ–π –≤—ã–±—Ä–∞–ª–∏ —ç—Ç–æ –±–ª—é–¥–æ
                                    </div>
                                </div>

                                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–ª—é–¥–µ -->
                                <div class="mt-3">
                                    <p class="card-text small text-muted">
                                        {{ dish.description|truncatechars:150 }}
                                    </p>
                                    <div class="d-flex justify-content-between">
                                        <span class="badge bg-light text-dark border">
                                            üßë‚Äçüç≥ {{ dish.get_difficulty_display }}
                                        </span>
                                        <span class="badge bg-light text-dark border">
                                            ‚≠ê {{ dish.popularity_score|floatformat:1 }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º -->
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º –±–ª—é–¥</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th>–¢–∏–ø –±–ª—é–¥–∞</th>
                                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                <th>–î–æ–ª—è</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for dish_type, count in type_distribution %}
                            <tr>
                                <td>{{ dish_type }}</td>
                                <td>{{ count }}</td>
                                <td>
                                    <div class="progress" style="height: 8px;">
                                        {% widthratio count popular_dishes|length 100 as percent %}
                                        <div class="progress-bar bg-info"
                                             style="width: {{ percent }}%">
                                        </div>
                                    </div>
                                    <small class="text-muted">{{ percent|floatformat:0 }}%</small>
                                </td>
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –º–µ–Ω—é</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <h6>üí° –°–æ–≤–µ—Ç—ã –ø–æ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—é –º–µ–Ω—é:</h6>
                            <ul class="mb-0">
                                <li>–í—ã–±–µ—Ä–∏—Ç–µ 3-5 —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –±–ª—é–¥</li>
                                <li>–°–æ—á–µ—Ç–∞–π—Ç–µ —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –±–ª—é–¥ (–∑–∞–∫—É—Å–∫–∏, –æ—Å–Ω–æ–≤–Ω—ã–µ, –¥–µ—Å–µ—Ä—Ç—ã)</li>
                                <li>–£—á–∏—Ç—ã–≤–∞–π—Ç–µ –≤—Ä–µ–º—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è</li>
                                <li>–ü–æ–º–Ω–∏—Ç–µ –æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∞–ª–ª–µ—Ä–≥–∏—è—Ö –≥–æ—Å—Ç–µ–π</li>
                            </ul>
                        </div>

                        <div class="mt-3">
                            <h6>‚úÖ –ò–¥–µ–∞–ª—å–Ω–æ–µ –º–µ–Ω—é –¥–ª—è {{ event.number_of_guests }} –≥–æ—Å—Ç–µ–π:</h6>
                            <ol>
                                <li>2-3 –∑–∞–∫—É—Å–∫–∏</li>
                                <li>1-2 –æ—Å–Ω–æ–≤–Ω—ã—Ö –±–ª—é–¥–∞</li>
                                <li>1-2 –¥–µ—Å–µ—Ä—Ç–∞</li>
                                <li>2-3 –Ω–∞–ø–∏—Ç–∫–∞</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–ø–∏—Å–∫—É –ø–æ–∫—É–ø–æ–∫ -->
        <div class="card mt-4 border-success">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0">üõí –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</h4>
            </div>
            <div class="card-body text-center">
                <div class="row">
                    <div class="col-md-8 mx-auto">
                        <h5>–ì–æ—Ç–æ–≤—ã —Å–¥–µ–ª–∞—Ç—å –ø–æ–∫—É–ø–∫–∏?</h5>
                        <p class="text-muted">
                            –°—Ñ–æ—Ä–º–∏—Ä—É–π—Ç–µ –ø–æ–¥—Ä–æ–±–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å —Ç–æ—á–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –¥–ª—è {{ event.number_of_guests }} –≥–æ—Å—Ç–µ–π
                        </p>

                        <a href="/event/{{ event.id }}/shopping/"
                           class="btn btn-success btn-lg px-5 py-3 mt-3">
                            üìã –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫
                        </a>

                        <div class="mt-4">
                            <div class="alert alert-info">
                                <h6>üí° –ß—Ç–æ –±—É–¥–µ—Ç –≤ —Å–ø–∏—Å–∫–µ:</h6>
                                <ul class="mb-0">
                                    <li>–¢–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞</li>
                                    <li>–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–æ–≤–æ—â–∏, –º—è—Å–æ –∏ —Ç.–¥.)</li>
                                    <li>–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</li>
                                    <li>–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–º–µ—Ç–∏—Ç—å –∫—É–ø–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã</li>
                                    <li>–ü–µ—á–∞—Ç—å —Å–ø–∏—Å–∫–∞ –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
        <div class="card mt-3">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-2">
                        <a href="/event/{{ event.id }}/show/" class="btn btn-outline-primary w-100">
                            ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≥–æ—Å—Ç—è–º
                        </a>
                    </div>
                    <div class="col-md-4 mb-2">
                        <a href="/create/" class="btn btn-outline-success w-100">
                            üéâ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
                        </a>
                    </div>
                    <div class="col-md-4 mb-2">
                        <a href="/dishes/" class="btn btn-outline-secondary w-100">
                            üçΩÔ∏è –í—Å–µ –±–ª—é–¥–∞
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        // –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫
        const cards = document.querySelectorAll('.card');
        cards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';

            setTimeout(() => {
                card.style.transition = 'all 0.5s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });

        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –±–ª—é–¥
        const popularBadges = document.querySelectorAll('.bg-success.fs-6');
        popularBadges.forEach(badge => {
            const count = parseInt(badge.textContent.split('/')[0]);
            const total = parseInt(badge.textContent.split('/')[1]);
            const percentage = (count / total) * 100;

            if (percentage > 50) {
                badge.classList.add('p-2');
                badge.innerHTML = 'üëë ' + badge.innerHTML;
            }
        });
    });
</script>
{% endblock %}